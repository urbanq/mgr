------------------------------------------------------------------------------------------------------------------------
-- JGP - jednorodne grupy pacjent√≥w
------------------------------------------------------------------------------------------------------------------------


------------------------------------------------------------------------------------------------------------------------
-- import data from CSV
CREATE TEMPORARY TABLE JGP_DEPARTMENT_TMP(
    JGP_CODE VARCHAR(5) NOT NULL,       -- Kod grupy JGP
    PRODUCT_CODE VARCHAR(15) NOT NULL,  -- kod produktu (zgodny z CZS)
    NAME VARCHAR(255) NOT NULL,         -- Nazwa JGP
    A1 CHAR(1),     -- alergologia
    A2 CHAR(1),     -- anestezjologia i intensywna terapia
    A3 CHAR(1),     -- angiologia
    A4 CHAR(1),     -- audiologia i foniatria
    C1 CHAR(1),     --
    C2 CHAR(1),     --
    C3 CHAR(1),     --
    C4 CHAR(1),     --
    C5 CHAR(1),     --
    C6 CHAR(1),     --
    C7 CHAR(1),     --
    C8 CHAR(1),     --
    C9 CHAR(1),     --
    C10 CHAR(1),    --
    D1 CHAR(1),     --
    D2 CHAR(1),     --
    E1 CHAR(1),     --
    G1 CHAR(1),     --
    G2 CHAR(1),     --
    G3 CHAR(1),     --
    H1 CHAR(1),     --
    I1 CHAR(1),     --
    K1 CHAR(1),     --
    K2 CHAR(1),     --
    N1 CHAR(1),     --
    N2 CHAR(1),     --
    N3 CHAR(1),     --
    N4 CHAR(1),     --
    O1 CHAR(1),     --
    O2 CHAR(1),     --
    O3 CHAR(1),     --
    O4 CHAR(1),     --
    O5 CHAR(1),     --
    P1 CHAR(1),     --
    P2 CHAR(1),     --
    R1 CHAR(1),     --
    T1 CHAR(1),     --
    T2 CHAR(1),     --
    U1 CHAR(1),     --
    NOTE CLOB
) AS SELECT * FROM CSVREAD('jgp_department.csv');

ALTER TABLE JGP_DEPARTMENT_TMP ADD FOREIGN KEY(JGP_CODE) REFERENCES JGP(CODE);
ALTER TABLE JGP_DEPARTMENT_TMP ADD FOREIGN KEY(PRODUCT_CODE) REFERENCES JGP(PRODUCT_CODE);

------------------------------------------------------------------------------------------------------------------------
-- save data structure without duplicates etc.
------------------------------------------------------------------------------------------------------------------------
CREATE TABLE JGP_DEPARTMENT(
    JGP_CODE VARCHAR(5) NOT NULL,
    DEPARTMENT_ID CHAR(3) NOT NULL,
    FOREIGN KEY(JGP_CODE) REFERENCES JGP(CODE),
    FOREIGN KEY(DEPARTMENT_ID) REFERENCES DEPARTMENT(ID),
    PRIMARY KEY(JGP_CODE, DEPARTMENT_ID)
);
------------------------------------------------------------------------------------------------------------------------
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'a1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE A1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'a2' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE A2 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'a3' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE A3 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'a4' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE A4 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c2' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C2 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c3' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C3 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c4' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C4 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c5' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C5 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c6' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C6 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c7' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C7 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c8' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C8 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c9' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C9 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'c10' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE C10 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'd1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE D1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'd2' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE D2 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'e1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE E1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'g1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE G1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'g2' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE G2 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'g3' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE G3 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'h1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE H1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'i1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE I1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'k1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE K1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'k2' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE K2 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'n1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE N1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'n2' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE N2 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'n3' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE N3 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'n4' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE N4 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'o1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE O1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'o2' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE O2 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'o3' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE O3 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'o4' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE O4 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'o5' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE O5 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'p1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE P1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'p2' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE P2 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'r1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE R1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 't1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE T1 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 't2' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE T2 IS NOT NULL;
INSERT INTO JGP_DEPARTMENT SELECT JGP_CODE, 'u1' AS DEPARTMENT_ID FROM JGP_DEPARTMENT_TMP WHERE U1 IS NOT NULL;
------------------------------------------------------------------------------------------------------------------------
DROP TABLE JGP_DEPARTMENT_TMP;